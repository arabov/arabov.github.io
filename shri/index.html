<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shri</title>
    <style>
        button {
            width: 130px;
            height: 20px;
            margin: -10px -65px;
            position: absolute;
            top: 50%;
            left: 50%;
        }
    </style>
</head>
<body>

    <button>Узнать численность</button>

    <script>
        /**
         * Реализация API, не изменяйте ее
         * @param {string} url
         * @param {function} callback
         */
        function getData(url, callback) {
            var RESPONSES = {
                '/countries': [
                    {name: 'Cameroon', continent: 'Africa'},
                    {name :'Fiji Islands', continent: 'Oceania'},
                    {name: 'Guatemala', continent: 'North America'},
                    {name: 'Japan', continent: 'Asia'},
                    {name: 'Yugoslavia', continent: 'Europe'},
                    {name: 'Tanzania', continent: 'Africa'}
                ],
                '/cities': [
                    {name: 'Bamenda', country: 'Cameroon'},
                    {name: 'Suva', country: 'Fiji Islands'},
                    {name: 'Quetzaltenango', country: 'Guatemala'},
                    {name: 'Osaka', country: 'Japan'},
                    {name: 'Subotica', country: 'Yugoslavia'},
                    {name: 'Zanzibar', country: 'Tanzania'}
                ],
                '/populations': [
                    {count: 138000, name: 'Bamenda'},
                    {count: 77366, name: 'Suva'},
                    {count: 90801, name: 'Quetzaltenango'},
                    {count: 2595674, name: 'Osaka'},
                    {count: 100386, name: 'Subotica'},
                    {count: 157634, name: 'Zanzibar'}
                ]
            };

            setTimeout(function () {
                var result = RESPONSES[url];
                if (!result) {
                    return callback('Unknown url');
                }

                callback(null, result);
            }, Math.round(Math.random * 1000));
        }

        /**
         * Ваши изменения ниже
         */
        var requests = ['/countries', '/cities', '/populations'];
        var responses = {};

        requests.forEach(function(request) {
            var callback = function(error, result) {
                if (error) {
                    console.log('Error: ' + error);
                    return;
                }
                responses[request] = result;
                var l = [];
                for (var K in responses)
                    l.push(K);

                if (l.length == 3) {
                    var c = [], cc = [], p = 0;

                    responses['/countries'].forEach(function(country) {
                        if (country.continent === 'Africa') {
                            c.push(country.name);
                        }
                    });

                    responses['/cities'].forEach(function(city) {
                        c.forEach(function(i) {
                            if (city.country === i) {
                                cc.push(city.name);
                            }
                        })
                    });

                    responses['/populations'].forEach(function(population) {
                        cc.forEach(function(i) {
                            if (population.name === i) {
                                p += population.count;
                            }
                        })
                    });

                    console.log('Total population in African cities: ' + p);
                }
            };

            getData(request, callback);
        });

        /**
         * Диалог
         */

        function findByCity(city) {
            var result = 0;
            responses['/populations'].forEach(function(population) {
                if (population.name === city) {
                    result = population.count;
                }
            });
            return result;
        }

        function findByCountry(country) {
            var result = 0;
            responses['/cities'].forEach(function(city) {
                if (city.country === country) {
                    result += findByCity(city.name);
                }
            });
            return result;
        }

        function getname() {
            var name = prompt('Введите название страны или города:');
            if (name) {
                var result = findByCountry(name) || findByCity(name);
                answer(name, result);
            }
        }

        function answer(name, population) {
            if (name && population) {
                alert('Численность населения в ' + name + ': ' + population);
            } else {
                alert('Нет данных');
            }

        }

        var button = document.getElementsByTagName('button')[0];
        button.onclick = getname;


    </script>
</body>
</html>